<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>게시글 상세 조회</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>게시글 상세 조회</h1>
<div id="boardDetail">
  <!-- 서버에서 받아온 게시글 상세 정보를 표시할 곳 -->
</div>

<!-- 수정하기 버튼 -->
<button id="editButton">수정하기</button>

<h2>전체 댓글</h2>
<ul id="commentList">
  <!-- 서버에서 받아온 전체 댓글을 여기에 표시할 것입니다. -->
</ul>

<script>
  $(document).ready(function() {
    // URL에서 boardId를 추출
    var urlParams = new URLSearchParams(window.location.search);
    var boardId = urlParams.get('boardId');

    // 서버로부터 해당 게시글의 상세 정보를 가져오는 AJAX 요청
    $.ajax({
      url: "/boards/" + boardId,
      type: "GET",
      success: function(response) {
        var boardDetailDiv = $("#boardDetail");
        boardDetailDiv.append("<p><strong>제목:</strong> " + response.title + "</p>");
        boardDetailDiv.append("<p><strong>내용:</strong> " + response.content + "</p>");
        boardDetailDiv.append("<p><strong>작성자:</strong> " + response.author + "</p>");
      },
      error: function(xhr, status, error) {
        console.error("게시글 상세 정보를 가져오는데 실패하였습니다.");
        console.error("에러:", error);
      }
    });

    // 수정하기 버튼 클릭 시 수정 페이지로 이동
    $("#editButton").click(function() {
      window.location.href = "editPage.html?boardId=" + boardId;
    });

    // 전체 댓글 조회
    $.ajax({
      url: "/comments?boardId=" + boardId,
      type: "GET",
      success: function(response) {
        var commentList = $("#commentList");
        response.forEach(function(comment) {
          var li = $("<li>").text(comment.text);
          var replyButton = $("<button>").text("대댓글 보기"); // 대댓글 보기 버튼 생성
          replyButton.click(function() {
            var replyList = $("<ul>"); // 대댓글을 표시할 리스트 생성
            // 대댓글을 가져오는 AJAX 요청
            $.ajax({
              url: "/replies?commentId=" + comment.id, // 해당 댓글의 대댓글을 가져오는 엔드포인트로 URL 구성
              type: "GET",
              success: function(replies) {
                // 요청이 성공하면 실행할 작업
                replies.forEach(function(reply) {
                  replyList.append($("<li>").text(reply.text));
                });
                // 대댓글 리스트를 보여줍니다.
                $(replyButton).after(replyList);
              },
              error: function(xhr, status, error) {
                console.error("대댓글을 가져오는데 실패하였습니다.");
                console.error("에러:", error);
              }
            });
          });
          li.append(replyButton); // 댓글 옆에 대댓글 보기 버튼 추가
          commentList.append(li);
        });
      },
      error: function(xhr, status, error) {
        console.error("전체 댓글을 가져오는데 실패하였습니다.");
        console.error("에러:", error);
      }
    });
  });
</script>
</body>
</html>
